<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" >
    <meta http-equiv="Content-Language" content="es" >
    <meta name="generator" content="XEmacs + HTML::Mason + mod_perl">
    <title>Introducción al lenguaje de programación Javascript</title>
    <meta name="AUTHOR" content="Juan Julián Merelo Guervós">

    <meta name="keywords" content="Computación distribuida, computación paralela, p2p, overlay, grid, evaluación de prestaciones, javascript">
    <meta name="description" content="Introducción rápida al lenguaje Javascript">
  <link href='http://fonts.googleapis.com/css?family=Arvo|Source+Code+Pro' rel='stylesheet' type='text/css'>
  </head>
<body>

<style type="text/css" media="all">
body { font-family: 'Arvo', serif; }

code.ejemplo {
  font-size:medium;
  white-space:pre;	
  display: block;
  padding: 2pt;
  background-color: lightYellow;
  color: darkBlue;
  border-style: double;
  border-color: #000080;
  border-width: 2pt;  font-family:  'Source Code Pro', Courier New, Courier;
  text-indent: 0%;
  margin-right: 5%;
  margin-left: 5%;
}

/* Style definition file generated by highlight 3.8, http://www.andre-simon.de/ */

/* Highlighting theme: Kwrite Editor */

body.hl	{ background-color:#e0eaee; }
pre.hl	{ color:#000000; background-color:#e0eaee; font-size:10pt; font-family:'Courier New';}
.hl.num { color:#b07e00; }
.hl.esc { color:#ff00ff; }
.hl.str { color:#bf0303; }
.hl.pps { color:#818100; }
.hl.slc { color:#838183; font-style:italic; }
.hl.com { color:#838183; font-style:italic; }
.hl.ppc { color:#008200; }
.hl.opt { color:#000000; }
.hl.lin { color:#555555; }
.hl.kwa { color:#000000; font-weight:bold; }
.hl.kwb { color:#0057ae; }
.hl.kwc { color:#000000; font-weight:bold; }
.hl.kwd { color:#010181; }

</style>

<h1>Introducción al lenguaje de programación Javascript</h1>


<div class='objetivos'> <ul>
	  
	  <li>Necesidad de este lenguaje de programación en la asignatura</li>
	  
	  <li>Aprender qué es Javascript</li> 

	  <li>Aprender la sintaxis de Javascript</li> 

	  <li>Usar objetos y clases en Javascript</li>
	  
	  <li>Realizar un pequeño ejemplo en Javascript</li>

      </ul>
</div>  

<h2>¿Javascript? Pero si es muy fácil</h2>

<p>Fuera de ser solamente un lenguaje para el navegador, <a href='http://es.wikipedia.org/wiki/Javascript'>Javascript</a>  tiene una ventaja frente a otros lenguajes
      de programación tiene una ventaja frente a otros lenguajes
      de programación . Está <em>en todas 
      partes</em>. No hay ordenador sin navegador, ni hay navegador sin
      Javascript (salvo en móviles y algunos PDAs). Se puede ejecutar
      hasta en el navegador Opera que viene con la Wii; desde la
      madurez de <a href='http://nodejs.org'>node.js</a>, es el único
      lenguaje que permite ejecutar aplicaciones en cliente y
      servidor, así que se ha convertido en uno de los lenguajes más
      útiles para desarrollo en Internet.</p>

<p>Esto se debe, en parte a que ha sido definido como un <a href='https://es.wikipedia.org/wiki/ECMAScript'>estándar
    ECMA (denominado ECMAScript)</a>  lo que da lugar a muchas implementaciones diferentes, que
      son, además, independientes del fabricante. Y, por otro lado,
      también suele usar un conjunto de objetos estándar (que no son
      estrictamente parte de un lenguaje) que se pueden
      usar para añadir funcionalidad a una aplicación. Muchas
      aplicaciones complejas, como <a
	href='http://gmail.com'>GMail</a> o <a
	href='http://docs.google.com'>Google docs</a> dependen de
      estos objetos para crear aplicaciones en la web que se comporten
      como si se ejecutaran en un sistema operativo nativo; a estas
      aplicaciones se les ha denominado últimamente <em>Rich
    Internet Applications</em>.</p>

<p>Además, a diferencia de otros lenguajes, es muy fácil crear una
      aplicación distribuida con Javascript. Tanto por su integración
      con el navegador (parte inseparable de la web, una arquitectura
      cliente-servidor) como por los objetos que suele tener el mismo,
      crear una aplicación cliente-servidor es casi trivial y ha dado
      lugar a un estilo de programación denominado <a href='http://es.wikipedia.org/wiki/AJAX'>AJAX</a>, que se
      verá más adelante en esta misma asignatura.</p> 

<p>Para ejecutar Javascript no hace falta más que un navegador, pero
      también hay entornos para trabajar con él de forma autónoma, tal
      como el <a
	href='https://developer.mozilla.org/en-US/'>Mozilla SpiderMonkey</a> y el <a href='https://developer.mozilla.org/en-US/docs/Rhino'>Rhino</a>, éste último basado en
      Java. Conviene instalar alguno de ellos para poder ejecutar los
      programas de ejemplo; por ejemplo, para instalar el primero
      habrá que ejecutar (desde la consola de administrador o
      superusuario):</p>
<div class='ejemplo'>bash% apt-get install smjs</div>
<p>En cuanto a los navegadores, puede que
      haga falta activar Javascript para que lo entiendan. Por
      ejemplo, en Firefox hay que activarlo usando Edit ->
      Preferencias -> Contenido -> Activar Javascript. Normalmente
      está activado por omisión. Por otro lado, veremos ejemplos
      principalmente de programas que se pueden usar desde el
      intérprete, y merece la pena instalarse uno. </p>

<div class='aclara'>Si usas Eclipse, puede que te venga bien el <a
	href='http://www.eclipse.org/webtools/jsdt/'>plugin
	JSDT</a>. Igual al atento lector le funciona
	correctamente. Por otro lado, el <code>xemacs</code> va de lujo. NetBeans
	tiene
	también <a href='http://netbeans.org/kb/docs/ide/javascript-editor.html'>soporte
    para JavaScript</a>, simplemente seleccionando este lenguaje para
	un nuevo fichero. El navegador detecta la estructura del
	fichero e incluso analiza el código indicando los problemas,
	indentando automáticamente y emparejando paréntesis y llaves. </div> 

<p>En realidad, esa integración con el navegador puede que haya
      estorbado a la aceptación de JS como un lenguaje <em>decente</em>;
      tampoco ha ayudado que la mayoría de las librerías que se hayan
      desarrollado estén relacionadas precisamente con la Web, y no
      tenga una librería decente para, pongamos por caso, acceder a
      bases de datos. Pero también ha permitido que el lenguaje siga
      siendo <em>pequeño</em>, y se haya desarrollado principalmente a base
      de añadir objetos y clases externas al mismo. En resumen, que en
      el marco de eso que se ha venido en llamar <a href='http://es.wikipedia.org/wiki/Web_2.0'>web 2.0</a> JS se
      ha convertido en adulto, y merece la pena estudiarlo como
      cualquier otro lenguaje.</p>

<p>Por último está el <a
	href='http://www.yaldex.com/JSFactory_Pro.htm'>1st Javascript
	Editor</a>, que es de pago, pero pueden conseguirse versiones
      de evaluación gratuitas. </p> 

<p>Por lo que he probado, SpiderMonkey, Rhino y
      KJSCMD se instalan fácilmente en Ubuntu; no hay más que hacer
      <code>aptitude search javascript</code> (en ubuntu) y salen esos y alguno más. Fedora
      Core es un poco más rácano en cuanto a entornos: aunque los
      puedes instalar bajándote los fuentes y compilando, el que está
      disponible en los repositorios es uno llamado sólo <code>js</code>,
      aparentemente el SpiderMonkey. Para instalarlo, escribir <code>yum install js</code>. Para los ejemplos que vienen en este tema,
      sustituir <code>#!/usr/bin/smjs</code> por <code>#!/usr/bin/js</code>. El Gnome Shell
      (incluido en la versión 3.0 de Gnome) incluye también un
      intérprete de JavaScript como lenguaje nativo, y con él se
      pueden desarrollar pequeños applets. Este intérprete, que está
      instalado por defecto junto con el entorno, se denomina <code>gjs</code> y
      está basado en SpiderMonkey y tiene la ventaja de que está
      integrado con todas las librerías de Gnome, de forma que se
  pueden hacer programas tales como <a href='https://github.com/JJ/curso-js/tree/master/code/g.js'>este</a>
      sin necesidad de instalar ningún  módulo adicional. Éste
  intérprete es el que usa desde <code>lg</code> (<em>looking glass</em>), una
      consola de depuración de Gnome al estilo de la consola del
      navegador que se puede ejecutar desde entorno pulsando Alt-F2 y
      escribiendo <code>lg</code>. Finalmente, Windows incluye <a href='http://stackoverflow.com/questions/686377/windows-command-line-javascript'>un programa de
    línea de órdenes denominado <code>cscript</code> y <code>wscript</code></a> que, una vez más, tiene
      ciertas diferencias con respecto al resto de los intérpretes
      (todo lo relacionado con I/O); en realidad se trata de JScript,
      otra implementación del estándar ECMAscript. </p>

  <p>También se puede instalar como cliente y servidor
  Javascript <a href='http://nodejs.org'>node.js</a>, un procesador
  de bucles de eventos que es también intérprete en JavaScript. Y
    mucho más... </p>


<h2>Primer programa en Javascript</h2>



<code class='ejemplo'>#!/usr/bin/smjs
print( 'Hola, Mundo' );</code>

<p>En realidad, el JS es bastante parecido al C, y, para el caso,
      también al Java. Este programa producirá:
<code class='ejemplo'>jmerelo@vega:~/txt/docencia/AAP/Temario$ code/js/hola.js
Hola, Mundo</code></p>

<p>Para ejecutarlo desde el navegador habrá que hacer una poca más de
      historia, pero tampoco tanto. Lo vemos en <a
	href='https://github.com/JJ/curso-js/tree/master/code/hola-js.html'>este ejemplo (darle a ver fuente
	para ver el código)</a> donde se incluye el programa en JS de
      esta forma:</p>
<code class='ejemplo'>&lt;script type='text/javascript' src='hola.js'>&lt;/script></code>

<p>El problema es que, en este caso, la orden <code>print</code> se
      interpreta como impresión por impresora, y habrá que cambiarla
      por otra que signifique lo mismo, escribir en el dispositivo de
      salida que se esté <a href='https://github.com/JJ/curso-js/tree/master/code/hola-js-2.html'>usando</a>:</p>
<code class='ejemplo'>document.writeln('Hola, Mundo')</code>

<p>Lo que también se puede escribir directamente <a
	href='https://github.com/JJ/curso-js/tree/master/code/hola-js-3.html'>así</a>:</p>
<code class='ejemplo'>&lt;script  type='text/javascript'>document.writeln('Hola, Mundo')&lt;/script></code>

<p>Estos programas se pueden usar con cualquier editor de texto,
 Emacs, Sublime Text o Notepad++; también con los entornos integrados,
 que te ofrecerán ventajas adicionales como completar las variables y
  los nombres de los comandos.</p>


<h2><a name='T1:t1:control'> Estructuras de control </a> <a href='#T1:t1:control' style='font-size:small'>#</a></h2>



<p>Vistas ya las mil y una formas de escribir cosas en la pantalla,
      procedamos a temas más escabrosos, como lo que viene siendo
      hacer algo <em>realmente</em>. Por ejemplo, un bucle que cree una tabla HTML, como se hace en el siguiente <a href='https://github.com/JJ/curso-js/tree/master/code/tabla.js'>programilla</a>:</p>
<code class='ejemplo'>var tabla="table";
var celda="td";
var fila="tr";
var matriz = [1,2,3];
print( "&lt;"+tabla+">");
for (i in matriz ) {
  print( "&lt;"+fila+">");
  for ( j in matriz ) {
    print ("&lt;"+celda+">"+matriz[i]*matriz[j]+"&lt;/"+celda+">");
  }
  print ("&lt;/"+fila+">\n");
 }
print ("&lt;/"+tabla+">");
    </code>

<p>Este programa tiene dos bucles anidados, que imprimen un producto
      dentro de una tabla. La salida será tal que así (ver el fuente
      para la estructura):</p>
<table>
<tr>
<td>1</td>
<td>2</td>
<td>3</td>
</tr>

<tr>
<td>2</td>
<td>4</td>
<td>6</td>
</tr>

<tr>
<td>3</td>
<td>6</td>
<td>9</td>
</tr>

</table>

<p>El programa es menos complicado de lo que parece. Para declarar
      variables en JS se usa el genérico <code>var</code>, aunque
      también se pueden declarar tipos específicos. Para no pillarnos
      los dedos, usamos var. En realidad, tampoco hace falta:
      simplemente usando una variable aparece mágicamente. Con las
      matrices ocurre igual (es decir, se declaran y se les asigna
      valor directamente)  : <code>matriz</code> lo es, y simplemente
      se declaran sus valores entre corchetes. Ojo con los nombres de
      variables, que a diferencia de otros lenguajes, distinguen
      entre mayúsculas y minúsculas. <code>esta_variable</code> es
      diferente de <code>esta_Variable</code>.</p>

<p>JS puede usar un tipo de bucle que tienen la apariencia habitual
      (en lenguajes derivados del C), y se pueden usar igual
      que en C, pero haremos un bucle que recorra la matriz, usando un
      <em>iterador</em> <code>i</code>, que en este caso se comporta como una variable
      de bucle de las de toda la vida. Usamos el <code>+</code> para
      concatenación de cadenas, y poco más. El resto es como el C, o
      el Java. De hecho, se pueden usar los bucles clásicos con
      comparación e incremento, como se muestra en <a
	href='https://github.com/JJ/curso-js/tree/master/code/tabla1.js'><code>tabla1.js</code></a>:</p>
<code class='ejemplo'>for (i=1; i&lt;=3; i++ ) {
  print( "&lt;"+fila+">");
  for ( j=1; j&lt;=3; j++  ) {
    print ("&lt;"+celda+">"+i*j+"&lt;/"+celda+">");
  }
  print ("&lt;/"+fila+">\n");
 }
    </code>

<p>Aunque queda un poco torpe tanto &lt;>... vamos a reducir un
      poco el programa, haciéndolo <a href='https://github.com/JJ/curso-js/tree/master/code/tabla2.js'>más
	elegante </a> (aunque más largo: no se puede tener todo):</p>

<code class='ejemplo'>
var matriz = [1,2,3];
print( marca('table'));
for (i in matriz ) {
  print( marca( 'tr' ));
  for ( j in matriz ) {
    print ( celda(matriz[i]*matriz[j]));
  }
  print ( finmarca('tr'));
}
print (finmarca('table'));

function marca( m ) {
  return "&lt;"+m+">";
}

function finmarca( m ) {
  return "&lt;/"+m+">";
}

function celda( contenido ) {
  return marca("td")+contenido+finmarca("td");
}</code>

<p>La principal diferencia con respecto al anterior es el <strong>uso de
      funciones</strong>. Las funciones en JS tienen una estructura bastante
      clásica: <code>function</code> nombre-de-función (param1, param2...). Una
      vez más, se nota que JS no e un lenguaje con tipos fuertes,
      pudiendo pasar los parámetros sin tipo, y adaptándose dentro de
      la función al tipo necesario. Se pasan por valor, es decir,
      que las modificaciones al parámetro formal no se trasladan a la
      variable que se use. Además, se pueden declarar donde a
    uno le dé la gana. Para llamarlas tampoco hay que hacer nada
      especial, se usa el clásico paréntesis. La salida es exactamente
    la misma que antes. El también clásico <code>return</code> devuelve un valor.
    </p>

<p>El ámbito de las variables es el bloque donde aparecen o se
      declaran, pero hay que tener en cuenta que, a efectos de JS, una
      página web es un <em>programa</em>. Se pueden declarar variables en la
      cabecera del documento HTML, y estarán accesibles en cualquier
      otro sitio, siempre que esté mas adelante en el
      documento. También habrá que tener en cuenta, en caso de que
      esté incluido en una página web, que aunque la declaración de
      una subrutina afecte a todo el programa, puede que esa parte de
      la página no se haya cargado todavía, con lo que no estará
      disponible. Una vez más, la programación distribuida no es totalmente
      igual a la programación en otros lenguajes. </p>






<h2><a name='T1:t2:clases'> Clases y objetos en Javascript </a> <a href='#T1:t2:clases' style='font-size:small'>#</a></h2>



<p>Javascript es un lenguaje basado en objetos, aunque un tanto
      peculiar; en realidad, de casi todas las características de un
      lenguaje orientado a objetos, solo tiene los objetos, e incluso
      estos son un tanto peculiares. Por eso no es exactamente <em>dirigido a objetos</em> u <em>orientado a objetos</em>. Las características las veremos en el siguiente <a
	href='https://github.com/JJ/curso-js/tree/master/code/quiniela.js'>programa</a>, que podría servir
      para hacer quinielas.</p>
<code class='ejemplo'>
var equipos= new Array('Madrid', 'Barça', 'Atleti', 'Geta', 'Betis', 'Depor', 'Sevilla', 'Graná');

   // Definición de la clase Partido
function Partido(local,visitante) {
  this.local = local;
  this.visitante=visitante;
  this.resultado=null;
}

var midsize = equipos.length/2;
var quiniela = new Array( midsize );
for ( i=0; i &lt; midsize ; i++ ) {
  var equipo1 = equipos.splice(Math.floor( equipos.length*Math.random()) , 1);
  var equipo2 = equipos.splice(Math.floor( equipos.length*Math.random()), 1);
  quiniela[i] = new Partido( equipo1, equipo2 );
 }

for ( i in quiniela ) {
        print( "Partido " + (parseInt(i)+1)+": " + quiniela[i].local + " - " + quiniela[i].visitante);
 }
    </code>

<p>Con lo primero que nos enfrentamos es con una nueva forma de
      definir una matriz o <code>Array</code>: ya que sabemos que JS es OO, pues
      usamos una forma OO de definirlo, mediante la orden <code>new</code>, que,
      como en Java y en C++, crea un nuevo objeto llamando al
      <em>constructor</em> del mismo. En este caso le pasamos directamente
      los elementos que constituyen el vector o <em>array</em>, pero
      podríamos haberle pasado el tamaño de esta forma:
<code class='ejemplo'>var myArray = new Array(33);</code>
Los objetos así creados son objetos de pleno derecho, y se puede
      acceder a sus propiedades con métodos usando también una
      sintaxis clásica: el puntito <code>.</code> tras el nombre de la
      variable. Por ejemplo, <code>myArray.length</code> devolvería el tamaño de
      la matriz</p>

<p>Pero como lo que se trata en este programa es de definir nosotros
      una clase, lo hacemos en las líneas siguientes, en la función
      <code>Partido</code>, que convencionalmente ponemos en mayúscula, para
      indicar que es un nombre de clase. En realidad, una clase en
      JS es una función dentro de la cual se le asigna un valor a la
      variable <code>this</code>, como en esta: cada uno de los elementos de la
      variable <code>this</code> será una variable de instancia. Como se ve, aquí
      no hay encapsulación ni perrito que le ladre. </p>

<p>Lo que vamos a crear es un vector de estos partidos, e irle
      asignando valores extraidos aleatoriamente. Mientras tanto,
      usamos los métodos que llevan objetos de clases estándar JS;
      igual que otros lenguajes tienen librería estándar, JS tiene
      clases estándar: <code>Array</code>, que ya hemos visto, y <code>Math</code>. Lo que
      usamos de <code>Math</code> son métodos de clase, no de instancia, tales
      como <code>Math.random</code>, que genera un número aleatorio entre 0 y
      1. También se usa un método de instancia, <code>splice</code>, que extrae
      una parte del vector de equipos; extraemos el seleccionado, para
      que dé por saco mientras generamos el resto de la guiniela. 
    </p>

<p>Y el objeto lo creamos mediante una clásica llamada: </p>
<code class='ejemplo'> quiniela[i] = new Partido( equipo1, equipo2 );</code>

<p>Más adelante usamos un bucle <code>in</code> para escribir los valores de cada
      uno de los partidos; las variables no están encapsuladas, así
      que se puede acceder a ellas directamente: <code>partido.local</code>, por
      ejemplo. Hay también un pequeño truco: el uso de <code>parseInt</code>
      dentro de <code>print</code> para que se interprete <code>i</code> como un número
      entero, no como una cadena, y, por tanto, el <code>+</code> que lo sigue
      como una suma normal y no una concatenación de cadenas. <code>i+1</code>
      daría <code>11</code>, mientras que <code>parseInt(i)+1</code> dará 2.</p>

<p>Y el resultado, aleatorio por supuesto, será algo así
      como esto :
<code class='ejemplo'>Partido 0: Graná - Atleti
Partido 1: Madrid - Depor
Partido 2: Betis - Barça
Partido 3: Sevilla - Geta</code>

<p>Añadir métodos de clase se hace más o menos de la misma forma, que
      no es muy ortodoxa, pero es la que hay. Lo veremos en <a
	href='https://github.com/JJ/curso-js/tree/master/code/quiniela2.js'>el siguiente programa</a>, del que
    sacamos el fragmento más interesante:</p>
<code class='ejemplo'>
   // Definición de la clase Partido
function Partido(local,visitante) {
  this.local = local;
  this.visitante=visitante;
  this.resultado=null;
  this.setResultado = setResultado;
  this.toString = toString;
}

function setResultado( esteResultado ) {
  if ( esteResultado == '1' || esteResultado=='x' || esteResultado=='2' ) 
    this.resultado = esteResultado;
}

function toString() {
    return "Partido " + i + ": " + this.local + " - " + this.visitante + " = "+ this.resultado;
}</code>
<p>Añadimos un par de funciones, y para que <em>pertenezcan</em> a la clase,
      hala, con un <code>this</code> por aquí y un <code>this</code> por allá,
      solucionado. Es de buen gusto llamar al método con el mismo
      nombre que la función, para no despistarse; también seguir una
      cierta convención para ponerles nombres: <code>get</code>, o <code>to</code>, o cosas
      por el estilo. Lo que no es de recibo es llamar a una función
      que cambia el valor de la variable igual que la variable, porque
      entonces nos liamos. Y como ya hemos visto antes como se llama a
    los métodos de instancia, pues listos. No se hable más.</p>



<h2>Matrices asociativas </h2>



<p>Pero hay más matrices, aparte de las lineales: JS, como muchos
      otros lenguajes, permite trabajar con <em>matrices asociativas</em>
      (también llamadas <em>diccionarios</em> o <em>hashes</em>). En una matriz
      asociativa, la clave es una cadena, en vez de un número, lo que
      le da mucha más flexibilidad a la hora de almacenar
      información. En un vector, se accede a cada uno de los elementos
      del vector a través de un índice numérico, y eso implica también
      un orden en su estructura (y, a veces, una continuidad en su
      almacenamiento, aunque no necesariamente tiene que ser así). Es
      decir, un vector lineal es un grupo de parejas (0, valor[0], 1,
      valor[1],...., n, valor[n]). De hecho, como los números suelen
      ser sucesivos, muchas veces se dan por sobreentendidos, de forma
    que para trabajar con un vector (ejecutar una operación sobre sus valores, por ejemplo)
      sólo se usan sus valores: valor[0], valor[1],..., valor[n].</p>

<p>Sin embargo, una matriz asociativa, diccionario, mapa o <a href='http://es.wikipedia.org/wiki/Tabla_hash'>Tabla_hash</a>
      (o simplemente <em>hash</em>) está compuesto por una serie de pares
      (cadena alfanumérica, valor): (cadena<sub>1</sub>, valor<sub>1</sub>,
      cadena<sub>2</sub>,valor<sub>2</sub>... cadena<sub>n</sub>,
      valor<sub>n</sub>). Los valores están asociados a su cadena
      correspondiente; de forma que se accede a los valores
      a través de la cadena alfanumérica usada para indexarlos, que
      se suele denominar <em>clave</em> (<em>key</em>). Casi todos los lenguajes
      de programación tienen alguna forma de usar estas matrices
      asociativas. Por ejemplo, en Perl:
<code class='ejemplo'>my %matrizAsociativa; # % para matrices asociativas
$matrizAsociativa{'variable'}='Valor'; # { para las claves
print $matrizAsociativa{'variable'};</code>
devolvería <code>Valor</code>. </p>

<p>Las usaremos en el <a
	href='https://github.com/JJ/curso-js/tree/master/code/liga.js'>siguiente programa</a>, que genera
      aleatoriamente diez jornadas de una liga, y asigna puntuación
      según los resultados:</p>
<code class='ejemplo'><span class="hl kwd">load</span><span class="hl opt">(</span><span class="hl str">'Partido.js'</span><span class="hl opt">);</span>

<span class="hl kwa">var</span> equipos<span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">Array</span><span class="hl opt">(</span><span class="hl str">'Madrid'</span><span class="hl opt">,</span> <span class="hl str">'Barça'</span><span class="hl opt">,</span> <span class="hl str">'Atleti'</span><span class="hl opt">,</span> <span class="hl str">'Geta'</span><span class="hl opt">,</span> <span class="hl str">'Betis'</span><span class="hl opt">,</span> <span class="hl str">'Depor'</span><span class="hl opt">,</span> <span class="hl str">'Sevilla'</span><span class="hl opt">,</span> <span class="hl str">'Graná'</span><span class="hl opt">);</span>

<span class="hl kwa">function</span> <span class="hl kwd">jornada</span><span class="hl opt">(</span> estosEquipos <span class="hl opt">) {</span>

  <span class="hl kwa">var</span> equiposAqui <span class="hl opt">=</span> <span class="hl kwa">new</span> Array<span class="hl opt">;</span>
  equiposAqui <span class="hl opt">=</span> equiposAqui<span class="hl opt">.</span><span class="hl kwd">concat</span><span class="hl opt">(</span>estosEquipos<span class="hl opt">);</span>
  <span class="hl kwa">var</span> midsize <span class="hl opt">=</span> equiposAqui<span class="hl opt">.</span>length<span class="hl opt">/</span><span class="hl num">2</span><span class="hl opt">;</span>
  <span class="hl kwa">var</span> quiniela <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">Array</span><span class="hl opt">(</span> midsize <span class="hl opt">);</span>
  <span class="hl kwa">var</span> unox2 <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">Array</span><span class="hl opt">(</span> <span class="hl str">'1'</span><span class="hl opt">,</span><span class="hl str">'x'</span><span class="hl opt">,</span><span class="hl str">'2'</span><span class="hl opt">);</span>
  <span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> i<span class="hl opt">=</span><span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> midsize <span class="hl opt">;</span> i<span class="hl opt">++ ) {</span>
    <span class="hl kwa">var</span> equipo1 <span class="hl opt">=</span> equiposAqui<span class="hl opt">.</span><span class="hl kwd">splice</span><span class="hl opt">(</span>Math<span class="hl opt">.</span><span class="hl kwd">floor</span><span class="hl opt">(</span> equiposAqui<span class="hl opt">.</span>length<span class="hl opt">*</span>Math<span class="hl opt">.</span><span class="hl kwd">random</span><span class="hl opt">()) ,</span> <span class="hl num">1</span><span class="hl opt">);</span>
    <span class="hl kwa">var</span> equipo2 <span class="hl opt">=</span> equiposAqui<span class="hl opt">.</span><span class="hl kwd">splice</span><span class="hl opt">(</span>Math<span class="hl opt">.</span><span class="hl kwd">floor</span><span class="hl opt">(</span> equiposAqui<span class="hl opt">.</span>length<span class="hl opt">*</span>Math<span class="hl opt">.</span><span class="hl kwd">random</span><span class="hl opt">()),</span> <span class="hl num">1</span><span class="hl opt">);</span>
    quiniela<span class="hl kwc">[i]</span> <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">Partido</span><span class="hl opt">(</span> equipo1<span class="hl opt">,</span> equipo2 <span class="hl opt">);</span>
    quiniela<span class="hl kwc">[i]</span><span class="hl opt">.</span><span class="hl kwd">setResultado</span><span class="hl opt">(</span> unox2<span class="hl opt">[</span>Math<span class="hl opt">.</span><span class="hl kwd">floor</span><span class="hl opt">(</span> <span class="hl num">3</span><span class="hl opt">*</span>Math<span class="hl opt">.</span><span class="hl kwd">random</span><span class="hl opt">()) ]);</span>
  <span class="hl opt">}</span>
  <span class="hl kwa">return</span> quiniela<span class="hl opt">;</span>
<span class="hl opt">}</span>


<span class="hl kwa">var</span> quinielas <span class="hl opt">=</span> <span class="hl kwa">new</span> Array<span class="hl opt">;</span>
<span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> <span class="hl num">10</span><span class="hl opt">;</span> i <span class="hl opt">++ ) {</span>
  quinielas<span class="hl kwc">[i]</span> <span class="hl opt">=</span> <span class="hl kwd">jornada</span><span class="hl opt">(</span> equipos <span class="hl opt">);</span> 
<span class="hl opt">}</span>

<span class="hl kwa">var</span> resultados<span class="hl opt">=</span> <span class="hl kwa">new</span> Array<span class="hl opt">;</span>
<span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> i <span class="hl kwa">in</span> equipos <span class="hl opt">) {</span>
  resultados<span class="hl opt">[</span>equipos<span class="hl kwc">[i]</span><span class="hl opt">]=</span><span class="hl num">0</span><span class="hl opt">;</span>
 <span class="hl opt">}</span>
<span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> quinielas<span class="hl opt">.</span>length<span class="hl opt">;</span> i <span class="hl opt">++ ) {</span>
  <span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> j <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>j <span class="hl opt">&lt;</span> quinielas<span class="hl kwc">[i]</span><span class="hl opt">.</span>length<span class="hl opt">;</span> j <span class="hl opt">++ ) {</span>
    <span class="hl kwa">var</span> local <span class="hl opt">=</span> quinielas<span class="hl kwc">[i][j]</span><span class="hl opt">.</span>local<span class="hl opt">;</span>
    <span class="hl kwa">var</span> visitante <span class="hl opt">=</span> quinielas<span class="hl kwc">[i][j]</span><span class="hl opt">.</span>visitante<span class="hl opt">;</span>
    <span class="hl kwa">var</span> resultado <span class="hl opt">=</span> quinielas<span class="hl kwc">[i][j]</span><span class="hl opt">.</span>resultado<span class="hl opt">;</span>
    <span class="hl kwa">if</span> <span class="hl opt">(</span> resultado <span class="hl opt">==</span> <span class="hl num">1</span> <span class="hl opt">) {</span>
      resultados<span class="hl kwc">[local]</span><span class="hl opt">+=</span><span class="hl num">3</span><span class="hl opt">;</span>
    <span class="hl opt">}</span> <span class="hl kwa">else if</span> <span class="hl opt">(</span> resultado <span class="hl opt">==</span> <span class="hl str">'x'</span> <span class="hl opt">) {</span>
      resultados<span class="hl kwc">[local]</span><span class="hl opt">+=</span><span class="hl num">1</span><span class="hl opt">;</span>
      resultados<span class="hl kwc">[visitante]</span><span class="hl opt">+=</span><span class="hl num">1</span><span class="hl opt">;</span>
    <span class="hl opt">}</span> <span class="hl kwa">else</span> <span class="hl opt">{</span> <span class="hl slc">// resultado == 2</span>
      resultados<span class="hl kwc">[visitante]</span><span class="hl opt">+=</span><span class="hl num">3</span>
    <span class="hl opt">}</span>
  <span class="hl opt">}</span>
 <span class="hl opt">}</span>

<span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> i <span class="hl kwa">in</span> resultados <span class="hl opt">) {</span>
  <span class="hl kwd">print</span><span class="hl opt">(</span> i <span class="hl opt">+</span> <span class="hl str">&quot;: &quot;</span> <span class="hl opt">+</span> resultados<span class="hl kwc">[i]</span><span class="hl opt">)</span>
 <span class="hl opt">}</span>
</code>

<p>En parte, este programa es similar a los anteriores: la parte que
      generaba cada jornada está ahora en una función, que devuelve un
      <code>array</code> de resultados, que se guardan en el array
      <code>quinielas</code>. Hemos sacado, además, la definición de la clase
      <code>Partido</code> a un fichero externo, que cargamos con <code>load</code>. Por
      otro lado, como a la función <code>jornada</code> se le pasa una referencia
      al vector con los equipos, tenemos que copiarlo a una variable
      local, definiéndola (<code>equiposAqui</code>), y concatenándole (<code>concat</code>)
      el vector que se le pasa por valor, que es igual que copiarlo,
      pero seo hace en una sola orden.</p>

<p>El truco está a partir de la definición de la
      variable <code>resultados</code>. Esta variable es una matriz asociativa
      que contendrá la puntuación de los equipos, y estará indexada
      por el nombre del equipo. Se declara igual que los demás arrays,
      y, para inicializarlo, vamos extrayendo los valores del vector
      de equipos, y usándolos como clave:
<code class='ejemplo'>resultados[equipos[i]]=0;</code>
<code>equipos[i]</code> valdrá sucesivamente Barça, Graná... y así se irán
      inicializando a 0 los valores correspondientes. Si no se
      inicializan, la primera vez que se usa una variable tiene el
      valor <code>NaN</code>, con el que no se puede hacer nada. Es así de
      arisco. </p>

<p>Más adelante se va recorriendo en un bucle doble los partidos de
      cada una de las jornadas, y asignando puntuación dependiendo del
      resultado de la quiniela. Se usa la construcción <code>if... else if
      ... else</code>, que funciona de la forma habitual, aunque también
      podríamos haber usado <code>switch</code>, como en <a
	href='https://github.com/JJ/curso-js/tree/master/code/liga2.js'>el siguiente programa</a>, que en lo
      único que cambia es en estas líneas:</p>
<code class='ejemplo'>    switch (resultado) {
    case '1':
      resultados[local]+=3;
      break;
    case 'x':
      resultados[local]+=1;
      resultados[visitante]+=1;
      break;
    default:
      resultados[visitante]+=3;
    }
  }
    </code>
<p>y que viene a ser como el anterior, pero con <code>case</code>s en vez de
      <code>if</code>s. Vamos, tres cuartos de lo mismo.</p>







<h2> Manejando Objetos </h2>



<p>En realidad, todo en Javascript es un objeto, y especialmente los
      vectores: tanto los vectores tradicionales como las matrices
      asociativas como los objetos se representan internamente de la
      misma forma, y te puedes referir a ellos de diferentes
      maneras. Vamos a usar el depurador interactivo para verlo,
      ejecutando simplemente <code>rhino</code>, <code>smjs</code> o <code>kjs</code> en la línea de
      comandos. Una vez hecho, tecleamos las siguientes órdenes:
<code class='ejemplo'><strong>js> foo = new Array</strong>

<strong>js> foo.cero='Cero'</strong>
Cero
<strong>js> foo[1] = 'Uno'</strong>
Uno
<strong>js> foo['dos'] = 'Dos'</strong>
Dos
<strong>js> foo.dos</strong>
Dos
<strong>js> foo['cero']</strong>
Cero
<strong>js> for ( i in foo) { print(foo[i]);}</strong>
Cero
Uno
Dos</code>
Hay que teclear lo que se encuentra detrás de <code>js></code>; cada segunda
      línea es la respuesta del intérprete a nuestras órdenes. En la
      primera, creamos un vector, y le asignamos valor a tres
      elementos de formas diferentes: usando la notación de objeto
      (con el .) para el 0, la notación de vector para el 1, y la
      notación de matriz asociativa para el 2. Luego se ve que,
      independientemente de cómo se haya asignado el valor, se puede
      usar cualquier otra notación para acceder al elemento; y,
      finalmente, vemos como se puede recorrer de forma uniforme el
      array usando sus componentes mediante la orden <code>in</code>. </p>

<p>Por eso precisamente, hay que tener un poco de cuidado con estos
      arrays asociativos que se comportan un poco como les da la
      gana. Es conveniente usar para ellos <code>Object</code>, que es lo que
      son, en vez de <code>Array</code>. De hecho, si en lo anterior sustituimos
      <code>Array</code> por <code>Object</code> dará exactamente el mismo resultado. Por
      eso <a
	href='http://andrewdupont.net/2006/05/18/javascript-associative-arrays-considered-harmful/'>se consideran perniciosas los arrays asociativos en JS</a>, pero es simplemente una cuestión de convención. </p>

<p>No todo va a ser público en un objeto; también pueden tener su
      intimidad guardada en variables privadas:</p>
<code class='ejemplo'><strong>js> function Foo( bar ) { this.bar = bar; var privada = 7;}</strong>
<strong>js> var este_foo = new Foo( 'correquetepillo' );</strong>

<strong>js> print(este_foo.bar)</strong>
correquetepillo
<strong>js> print(este_foo.privada)</strong>
undefined</code>
<p>Es tan secreta, de hecho, que ni siquiera te dice que no existe:
      simplemente que su valor está indefinido. </p>

<p>El propio estándard Javascript (ECMAScript) define una serie de
      clases que se pueden instanciar, que corresponderían a la
      librería estándar (o librería estándar de clases) en otros
      lenguajes. Una de ellas ya la hemos visto: la clase
      <code>Array</code>. Otra es la clase <code>String</code>, que se usa para manejar
      cadenas alfanuméricas, chorros de 0s y 1s. 
<code class='ejemplo'><strong>js> var cadena = new String("1");</strong>
<strong>js> print(cadena + 1)</strong>
11
      </code>
La clase <code>String</code> tiene una serie de métodos que permiten hacer lo
      habitual con las cadenas: encadenarlas, dividirlas, y buscar
      cosas. 
<code class='ejemplo'><strong>js> var nombres = "Pedro, Lucas, Juan".split(", ");</strong>
<strong>js> print(nombres[0])</strong>
Pedro</code>
En este caso, <code>split</code> es un método de la clase String, y lo estamos
      aplicando directamente sobre la cadena <code>"Pedro, Lucas, Juan"</code>,
      que, de por si, es un objeto de esa clase. <code>split</code> divide la
      cadena usando los caracteres que le pasamos, y da lugar a un
      <code>Array</code> con tantos componentes como resulte.</p>

<p>De camino, podría haber una clase para escribir y leer ficheros,
      porque con el rato que llevamos, todavía no hemos visto ninguna,
      y, además, cualquier lenguaje decente escribe y lee ficheros. Es
      más, es que muchos no hacen otra cosa, ¿no? Pues no. El estándar
      JS no define ningún tipo de rutina de E/S. Pero si usamos el
      intérprete Rhino (en vez de SpiderMonkey, que es el que hemos
      venido usando), podemos usar clases de Java directamente, lo que
      complica terriblemente el programa, pero <a
	href='https://github.com/JJ/curso-js/tree/master/code/lee_quiniela.js'>ahí está, de todas
	formas</a>:</p>
<code class='ejemplo'><span class="hl slc">// ejecutar con rhino lee_quiniela.js &lt;argumento&gt;</span>
<span class="hl kwd">load</span><span class="hl opt">(</span><span class="hl str">'Partido.js'</span><span class="hl opt">);</span>
<span class="hl kwa">var</span> FileReader <span class="hl opt">=</span> java<span class="hl opt">.</span>io<span class="hl opt">.</span>FileReader<span class="hl opt">;</span>
<span class="hl kwa">var</span> BufferedReader <span class="hl opt">=</span>java<span class="hl opt">.</span>io<span class="hl opt">.</span>BufferedReader<span class="hl opt">;</span>

<span class="hl kwa">var</span> file_name <span class="hl opt">=</span> arguments<span class="hl kwc">[0]</span><span class="hl opt">;</span>

<span class="hl kwa">var</span> f <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">FileReader</span><span class="hl opt">(</span>file_name<span class="hl opt">);</span>
<span class="hl kwa">var</span> br <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">BufferedReader</span><span class="hl opt">(</span> f <span class="hl opt">);</span>
<span class="hl kwa">var</span> resultados<span class="hl opt">=</span> <span class="hl kwa">new</span> Array<span class="hl opt">;</span>
<span class="hl kwa">var</span> line <span class="hl opt">=</span> <span class="hl kwa">new</span> String<span class="hl opt">;</span>
<span class="hl kwa">while</span> <span class="hl opt">((</span>line <span class="hl opt">=</span> br<span class="hl opt">.</span><span class="hl kwd">readLine</span><span class="hl opt">()) !=</span> <span class="hl kwa">null</span><span class="hl opt">) {</span>
  <span class="hl kwa">var</span> estaLinea <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">String</span><span class="hl opt">(</span> line <span class="hl opt">);</span>
  <span class="hl kwa">var</span> resultado  <span class="hl opt">=</span> estaLinea<span class="hl opt">.</span><span class="hl kwd">split</span><span class="hl opt">(</span><span class="hl str">&quot; &quot;</span><span class="hl opt">);</span>
  <span class="hl kwa">switch</span> <span class="hl opt">(</span>resultado<span class="hl kwc">[2]</span><span class="hl opt">) {</span>
    <span class="hl kwa">case</span> <span class="hl str">'1'</span><span class="hl opt">:</span>
      <span class="hl kwa">if</span> <span class="hl opt">(</span> resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[0]</span><span class="hl opt">] ) {</span>
	resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[0]</span><span class="hl opt">]+=</span><span class="hl num">3</span><span class="hl opt">;</span>
      <span class="hl opt">}</span> <span class="hl kwa">else</span> <span class="hl opt">{</span>
	resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[0]</span><span class="hl opt">]=</span><span class="hl num">3</span><span class="hl opt">;</span>
      <span class="hl opt">}</span>
      <span class="hl kwa">break</span><span class="hl opt">;</span>
    <span class="hl kwa">case</span> <span class="hl str">'x'</span><span class="hl opt">:</span>
      <span class="hl kwa">if</span> <span class="hl opt">(</span> resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[0]</span><span class="hl opt">] ) {</span>
	resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[0]</span><span class="hl opt">]+=</span><span class="hl num">1</span><span class="hl opt">;</span>
      <span class="hl opt">}</span> <span class="hl kwa">else</span> <span class="hl opt">{</span>
	resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[0]</span><span class="hl opt">]=</span><span class="hl num">1</span><span class="hl opt">;</span>
      <span class="hl opt">}</span>
      <span class="hl kwa">if</span> <span class="hl opt">(</span> resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[1]</span><span class="hl opt">] ) {</span>
	resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[1]</span><span class="hl opt">]+=</span><span class="hl num">1</span><span class="hl opt">;</span>
      <span class="hl opt">}</span> <span class="hl kwa">else</span> <span class="hl opt">{</span>
	resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[1]</span><span class="hl opt">]=</span><span class="hl num">1</span><span class="hl opt">;</span>
      <span class="hl opt">}</span>
      <span class="hl kwa">break</span><span class="hl opt">;</span>
    <span class="hl kwa">default</span><span class="hl opt">:</span>
       <span class="hl kwa">if</span> <span class="hl opt">(</span> resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[1]</span><span class="hl opt">] ) {</span>
	resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[1]</span><span class="hl opt">]+=</span><span class="hl num">3</span><span class="hl opt">;</span>
      <span class="hl opt">}</span> <span class="hl kwa">else</span> <span class="hl opt">{</span>
	resultados<span class="hl opt">[</span>resultado<span class="hl kwc">[1]</span><span class="hl opt">]=</span><span class="hl num">3</span><span class="hl opt">;</span>
      <span class="hl opt">}</span>
      <span class="hl kwa">break</span>
  <span class="hl opt">}</span>
 <span class="hl opt">}</span>

<span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> i <span class="hl kwa">in</span> resultados <span class="hl opt">) {</span>
  <span class="hl kwd">print</span><span class="hl opt">(</span> i <span class="hl opt">+</span> <span class="hl str">&quot;: &quot;</span> <span class="hl opt">+</span> resultados<span class="hl kwc">[i]</span><span class="hl opt">)</span>
    <span class="hl opt">}</span> </code>

<p>El programa es bastante similar al anterior, pero lee de fichero en
      vez de generar los resultados aleatoriamente. Y lo lee
      aproximadamente de la misma forma a como se haría en Java. Por
      eso hay que usar Rhino, que permite usar las clases de la
      librería estándar de Java de forma <em>nativa</em>. En este caso
      usamos dos clases: <code>FileReader</code> y <code>BufferedReader</code>, para poder
      leer de línea en línea. La única diferencia a como se haría en
      Java es que hay que pasar la línea leida de un objeto <code>String</code>
      de Java a un objeto <code>String</code> de JS, que es lo que se hace en
      <code>var estaLinea = new String( line );</code>. También sale un poco más
      largo porque, como indicamos en el programa de más arriba, los
      elementos de un <code>Array</code> hay que inicializarlos; en cada caso del
      <code>switch</code> comprobamos si están inicializados o no antes de
      sumarles; si no lo está, le asignamos el valor
      directamente. </p>

<p>En realidad, las primeras líneas lo único que hacen es declarar un
      <em>alias</em> para las clases de Java. En JS una variable puede
      contener cualquier cosa, incluso una clase. Así acortamos el
      nombre, y parecen más de javascrí. </p>

<p>La otra diferencia es también cómo se ejecuta el fichero: 
<code class='ejemplo'>rhino lee_quiniela.js quiniela.datos</code>
para ejecutarlo sobre el <a href='https://github.com/JJ/curso-js/tree/master/code/quiniela.datos'>fichero
	<code>quiniela.datos</code></a>, que dará el resultado siguiente:
<code class='ejemplo'>Elche: 1
Atleti: 3
Cai: 1
Athleti: 6
Bar~a: 1
Madrid: 2
H~rcules: 1</code>
Queda con esto más o menos claro que para ir donde nadie ha ido antes
      con JS, hay que meterse un poco en Java. Pero no siempre. Tenéis
alguna información más
en <a href='http://www.mozilla.org/rhino/ScriptingJava.html'>este
  tutorial de Mozilla</a>, que te explica como importar espacios de
nombres completos e incluso como implementar intervaces de Java. </p>

<p>Aunque no lo parezca, JS es todavía un lenguaje joven, al que le
      faltan gran cantidad de librerías básicas, y, especialmente, una
      forma centralizada de empaquetar, probar y distribuir esas
      librerías, como <a href='http://www.cpan.org'>CPAN</a> para Perl o
      GEMs para Ruby. Hay algo por el estilo, <a
	href='http://openjsan.org'>llamado OpenJSAN</a>, de JS Archive
      Network. Para instalarlo hace falta Perl, y sólo hay unas pocas
      librerías todavía. Algunas muy  útiles, pero siguen siendo unas
      pocas. Otras, como la amplia <a
	href='http://code.google.com/p/jslibs/'>JSlib</a>, sólo va en
      Windows. En todo caso, a estas alturas parece un proyecto muerto. </p>

<p>La que si es popular es <a
	href='http://prototypejs.org/'>Prototype</a>, una librería
      que se usa principalmente en conjunción con RoR y AJAX, pero
      resulta que necesita ejecutarse dentro del navegador, porque usa
    objetos del mismo (como <code>document</code>, por ejemplo). Así que la
	dejaremos para más adelante.</p> 





<h2> Objetos para el camino </h2>



<p>Lo interesante de los objetos en JS es que hay una forma muy fácil
      de <em>serializarlos</em> (es decir, convertirlos en texto u otro
      formato de forma que se puedan intercambiar fácilmente con otros
      programas a través de la red); a este formato se le denomina
      <a href='http://es.wikipedia.org/wiki/JSON'>JSON</a> (JavaScript Object Notation). Y como en realidad,
      tal como se ha visto en el apartado anterior, todo es un objeto
      en JS, se puede usar esta notación para asignar valores
      prácticamente a cualquier cosa. Vamos a usar una vez más el
      intérprete en modo interactivo para ver un ejemplo:</p>
<code class='ejemplo'><strong>js> var objeto = { Madrid : 25, Atleti: 33, Ponferradina: 44 };</strong>
<strong>js> for (i in objeto) { print( i + " : "+ objeto[i] )};</strong>
Madrid : 25
Atleti : 33
Ponferradina : 44
</code>

<p>Más fácil no puede ser. Se le asigna valor a un objeto con el formato
      clave : valor (con coma al final), de la misma forma que se
      haría a un array asociativo. Además, se pueden crear objetos
      sobre la marcha y asignárselos a una variable cuyo valor se cree
  también sobre la marcha:</p>
<code class='ejemplo'><strong>js> eval("var objeto2 = { Madrid : 25, Atleti: 33, Ponferradina: 44 }");</strong>
<strong>js> for (i in objeto2) { print( i + " : "+ objeto[i] )};</strong>
Madrid : 25
Atleti : 33
Ponferradina : 44</code>
donde usamos <code>eval</code>, que interpreta una expresión en Javascript como
      si del propio intérprete se tratara. Las expresiones se pueden
      anidar, para dar lugar a objetos más complejos
<code class='ejemplo'><strong>js> eval("var objeto2 = { Madrid : 25, Atleti: 33, Ponferradina: { casa: 33, fuera: 44} }");</strong>
<strong>js> for (i in objeto2) { print( i + " : "+ objeto2[i] )};</strong>
Madrid : 25
Atleti : 33
Ponferradina : [object Object]</code>
Que parece más raro de la cuenta, pero que, con un poco de código, se
      podría también imprimir.</p>

<p>Y JSON, precisamente, es uno de los formatos de intercambio, el más
      simple, el que se usa en AJAX, y un modo de acceder también a
      servicios web como <em>geonames</em>. Lo hacemos en <a href='https://github.com/JJ/curso-js/tree/master/code/json-geonames.html'>el
	siguiente ejemplo: <code>json-geonames.html</code></a>, del que extraemos
    el <a href='https://github.com/JJ/curso-js/tree/master/code/geonames_call.js'>código en JS (fichero <code>geonames_call.js</code>)</a></p>
<code class='ejemplo'><span class="hl slc">// this function will be called by our JSON callback</span>
<span class="hl slc">// the parameter jData will contain an array with geonames objects</span>
<span class="hl kwa">function</span> <span class="hl kwd">getLocation</span><span class="hl opt">(</span>jData<span class="hl opt">) {</span>
  <span class="hl kwa">if</span> <span class="hl opt">(</span>jData <span class="hl opt">==</span> <span class="hl kwa">null</span><span class="hl opt">) {</span>
    <span class="hl slc">// There was a problem parsing search results</span>
    <span class="hl kwa">return</span><span class="hl opt">;</span>
  <span class="hl opt">}</span>

  <span class="hl kwa">var</span> html <span class="hl opt">=</span> <span class="hl str">'&lt;ul&gt;'</span><span class="hl opt">;</span>
  <span class="hl kwa">var</span> geonames <span class="hl opt">=</span> jData<span class="hl opt">.</span>geonames<span class="hl opt">;</span>
  <span class="hl kwa">for</span> <span class="hl opt">(</span>i<span class="hl opt">=</span><span class="hl num">0</span><span class="hl opt">;</span>i<span class="hl opt">&lt;</span> geonames<span class="hl opt">.</span>length<span class="hl opt">;</span>i<span class="hl opt">++) {</span>
     <span class="hl kwa">var</span> name <span class="hl opt">=</span> geonames<span class="hl kwc">[i]</span><span class="hl opt">;</span>
     <span class="hl slc">// we create a simple html list with the geonames objects</span>
     <span class="hl slc">// the link will call the center() javascript method with lat/lng as parameter</span>
     html <span class="hl opt">=</span> html<span class="hl opt">+</span><span class="hl str">&quot;&lt;li&gt;&lt;em&gt;&quot;</span><span class="hl opt">+</span>name<span class="hl opt">.</span>name<span class="hl opt">+</span> <span class="hl str">&quot;&lt;/em&gt; - Latitud: &quot;</span> <span class="hl opt">+</span> name<span class="hl opt">.</span>lat <span class="hl opt">+</span><span class="hl str">', longitud: '</span> <span class="hl opt">+</span> name<span class="hl opt">.</span>lng<span class="hl opt">+</span> <span class="hl str">&quot;&lt;/li&gt;&quot;</span><span class="hl opt">;</span>
  <span class="hl opt">}</span>
  html<span class="hl opt">+=</span><span class="hl str">&quot;&lt;/ul&gt;&quot;</span><span class="hl opt">;</span>
  document<span class="hl opt">.</span><span class="hl kwd">getElementById</span><span class="hl opt">(</span><span class="hl str">'resultDiv'</span><span class="hl opt">).</span>innerHTML <span class="hl opt">=</span> html<span class="hl opt">;</span>
<span class="hl opt">}</span>

<span class="hl slc">// calls the geonames JSON webservice with the search term</span>
<span class="hl kwa">function</span> <span class="hl kwd">search</span><span class="hl opt">() {</span>
  request <span class="hl opt">=</span> <span class="hl str">'http://ws.geonames.org/searchJSON?country=ES&amp;q='</span> <span class="hl opt">+</span>  <span class="hl kwd">encodeURIComponent</span><span class="hl opt">(</span>document<span class="hl opt">.</span><span class="hl kwd">getElementById</span><span class="hl opt">(</span><span class="hl str">'q'</span><span class="hl opt">).</span>value<span class="hl opt">)  +</span> <span class="hl str">'&amp;maxRows=10&amp;callback=getLocation'</span><span class="hl opt">;</span>

  <span class="hl slc">// Create a new script object</span>
  <span class="hl slc">// Implementación en jsr_class.js</span>
  aObj <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">JSONscriptRequest</span><span class="hl opt">(</span>request<span class="hl opt">);</span>
  <span class="hl slc">// Build the script tag</span>
  aObj<span class="hl opt">.</span><span class="hl kwd">buildScriptTag</span><span class="hl opt">();</span>
  <span class="hl slc">// Execute (add) the script tag</span>
  aObj<span class="hl opt">.</span><span class="hl kwd">addScriptTag</span><span class="hl opt">();</span>
<span class="hl opt">}</span></code>

<p>Este ejemplo es un poco complicado, sobre todo, por el mecanismo
      que usa para hacer la llamada, y que está contenido en el
      fichero <a href='https://github.com/JJ/curso-js/tree/master/code/jsr_class.js'><code>jsr_class.js</code>, que
	contiene la clase <code>JSONscriptRequest</code></a>, que será la que
      usemos para construir la llamada. La mecánica es la siguiente:
      cada vez que se introduce un nombre de un pueblo o ciudad de
      España, se genera un evento, y se llama a la función
      <code>search</code>. Esta función  construye una petición, dentro de la
      cual está incluido <code>callback=getLocation</code>. El truco
      es que esa petición genera un <em>callback</em> tal que cuando se
      recibe la respuesta se llama a la función <code>getLocation</code>
      (definida más arriba).</p>

<p>Esa función recibe como variable en <code>jData</code> el resultado que, al
      estar en formato JSON, ya está, de hecho, en el formato de un
      objeto en JS. Por eso, en el bucle dentro de la función
      <code>getLocation</code> se trabaja directamente con los datos obtenidos
  sin necesidad de hacer ningún tipo de parsing.</p>


<h2> Funciones como objetos </h2>



<p>Las funciones son objetos de pleno derecho en JavaScript. Se puede
  crear una función como  cualquier otro objeto, y de hecho ya hemos visto algo
  parecido cuando hemos definido una clase (que es simplemente un tipo
  de función). Como tales objetos, podemos pasarlas como parámetros y
  modificarlas de diferentes formas; algo así hemos visto ya cuando
  hemos definido objetos también, en los que se asignan los nombres de
  funciones a métodos de una clase simplemente usando su nombre (en realidad, un puntero a función). Las
  diferentes formas de definir funciones se explican 
  en <a href='http://stackoverflow.com/questions/1140089/how-does-an-anonymous-function-in-javascript-work'>
    este post de StackOverflow (un recurso imprescindible, por otro lado).</a></p>

<p>Vamos a verlo a verlo a continuación, usando nuestra conocida
  quiniela; usaremos una función para imprimir el resultado de la
  quiniela, de forma que se pueda ver la salida de varias formas
  diferentes. En <a href='https://github.com/JJ/curso-js/tree/master/code/Nuevo_partido.js'>el siguiente
    módulo hacemos uso de esta funcionalidad</a>: </p>

<code class='ejemplo'>// Definición de la clase Partido
<span class="hl kwa">function</span> <span class="hl kwd">Nuevo_partido</span><span class="hl opt">(</span>local<span class="hl opt">,</span>visitante<span class="hl opt">) {</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>local <span class="hl opt">=</span> local<span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>visitante<span class="hl opt">=</span>visitante<span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>resultado<span class="hl opt">=</span><span class="hl kwa">null</span><span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>setResultado <span class="hl opt">=</span> setResultado<span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>toString <span class="hl opt">=</span> toString<span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>set_to_string <span class="hl opt">=</span> set_to_string<span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>impresor <span class="hl opt">=</span> _toString<span class="hl opt">;</span>
<span class="hl opt">}</span>

<span class="hl kwa">function</span> <span class="hl kwd">setResultado</span><span class="hl opt">(</span> esteResultado <span class="hl opt">) {</span>
    <span class="hl kwa">if</span> <span class="hl opt">(</span> esteResultado <span class="hl opt">==</span> <span class="hl str">'1'</span> || esteResultado<span class="hl opt">==</span><span class="hl str">'x'</span> || esteResultado<span class="hl opt">==</span><span class="hl str">'2'</span> <span class="hl opt">)</span> 
	<span class="hl kwa">this</span><span class="hl opt">.</span>resultado <span class="hl opt">=</span> esteResultado<span class="hl opt">;</span>
<span class="hl opt">}</span>

<span class="hl kwa">function</span> <span class="hl kwd">toString</span><span class="hl opt">() {</span>
    <span class="hl kwa">return this</span><span class="hl opt">.</span><span class="hl kwd">impresor</span><span class="hl opt">(</span><span class="hl kwa">this</span><span class="hl opt">.</span>local<span class="hl opt">,</span> <span class="hl kwa">this</span><span class="hl opt">.</span>visitante<span class="hl opt">,</span> <span class="hl kwa">this</span><span class="hl opt">.</span>resultado<span class="hl opt">);</span>
<span class="hl opt">}</span>

<span class="hl kwa">function</span> <span class="hl kwd">_toString</span><span class="hl opt">(</span> local<span class="hl opt">,</span> visitante <span class="hl opt">) {</span>
    <span class="hl kwa">return</span> <span class="hl str">&quot;: &quot;</span> <span class="hl opt">+</span> local <span class="hl opt">+</span> <span class="hl str">&quot; - &quot;</span> <span class="hl opt">+</span> visitante <span class="hl opt">+</span> <span class="hl str">&quot; = &quot;</span><span class="hl opt">+</span> resultado<span class="hl opt">;</span>
<span class="hl opt">}</span>

<span class="hl kwa">function</span> <span class="hl kwd">set_to_string</span> <span class="hl opt">(</span> impresor <span class="hl opt">) {</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>impresor <span class="hl opt">=</span> impresor<span class="hl opt">;</span>
<span class="hl opt">}</span>
</code>

<p>En esta clase la principal diferencia es que usamos el método
  <code>impresor</code> como una variable al cual le podemos asignar diferentes
  valores, incluso desde fuera. De esta forma se puede modificar el
  comportamiento de un objeto: asignamos un comportamieento por
  omisión, pero si es necesario podemos cambiar <em>desde fuera</em>
  el comportamiento de esa clase simplemente asignándole un valor
  nuevo. De hecho, esto es lo que vamos a hacer en el <a href='https://github.com/JJ/curso-js/tree/master/code/liga3.js'>programa
    siguiente (<code>liga3.js</code>)</a>: </p>


<code class='ejemplo'>#<span class="hl opt">!/</span>usr<span class="hl opt">/</span>bin<span class="hl opt">/</span>smjs

<span class="hl kwd">load</span><span class="hl opt">(</span><span class="hl str">'Nuevo_partido.js'</span><span class="hl opt">);</span>

<span class="hl kwa">var</span> equipos<span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">Array</span><span class="hl opt">(</span><span class="hl str">'Madrid'</span><span class="hl opt">,</span> <span class="hl str">'Barça'</span><span class="hl opt">,</span> <span class="hl str">'Atleti'</span><span class="hl opt">,</span> <span class="hl str">'Geta'</span><span class="hl opt">,</span> <span class="hl str">'Betis'</span><span class="hl opt">,</span> <span class="hl str">'Depor'</span><span class="hl opt">,</span> <span class="hl str">'Sevilla'</span><span class="hl opt">,</span> <span class="hl str">'Graná'</span><span class="hl opt">);</span>

<span class="hl kwa">function</span> <span class="hl kwd">jornada</span><span class="hl opt">(</span> estosEquipos <span class="hl opt">) {</span>
    <span class="hl kwa">var</span> equiposAqui <span class="hl opt">=</span> <span class="hl kwa">new</span> Array<span class="hl opt">;</span>
    <span class="hl kwa">var</span> imprime <span class="hl opt">=</span> <span class="hl kwa">function</span><span class="hl opt">(</span> local<span class="hl opt">,</span> visitante<span class="hl opt">,</span> resultado <span class="hl opt">) {</span> 
	<span class="hl kwd">print</span><span class="hl opt">(</span><span class="hl str">&quot;Impimiendo</span> <span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
	<span class="hl kwa">return</span>  <span class="hl str">&quot;- &quot;</span> <span class="hl opt">+</span> local <span class="hl opt">+</span> <span class="hl str">&quot; vs. &quot;</span> <span class="hl opt">+</span> visitante <span class="hl opt">+</span> <span class="hl str">&quot; resultado  &quot;</span><span class="hl opt">+</span> resultado<span class="hl opt">;</span>
    <span class="hl opt">};</span>
    equiposAqui <span class="hl opt">=</span> equiposAqui<span class="hl opt">.</span><span class="hl kwd">concat</span><span class="hl opt">(</span>estosEquipos<span class="hl opt">);</span>
    <span class="hl kwa">var</span> midsize <span class="hl opt">=</span> equiposAqui<span class="hl opt">.</span>length<span class="hl opt">/</span><span class="hl num">2</span><span class="hl opt">;</span>
    <span class="hl kwa">var</span> quiniela <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">Array</span><span class="hl opt">(</span> midsize <span class="hl opt">);</span>
    <span class="hl kwa">var</span> unox2 <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">Array</span><span class="hl opt">(</span> <span class="hl str">'1'</span><span class="hl opt">,</span><span class="hl str">'x'</span><span class="hl opt">,</span><span class="hl str">'2'</span><span class="hl opt">);</span>
    <span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> i<span class="hl opt">=</span><span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> midsize <span class="hl opt">;</span> i<span class="hl opt">++ ) {</span>
	<span class="hl kwa">var</span> equipo1 <span class="hl opt">=</span> equiposAqui<span class="hl opt">.</span><span class="hl kwd">splice</span><span class="hl opt">(</span>Math<span class="hl opt">.</span><span class="hl kwd">floor</span><span class="hl opt">(</span> equiposAqui<span class="hl opt">.</span>length<span class="hl opt">*</span>Math<span class="hl opt">.</span><span class="hl kwd">random</span><span class="hl opt">()) ,</span> <span class="hl num">1</span><span class="hl opt">);</span>
	<span class="hl kwa">var</span> equipo2 <span class="hl opt">=</span> equiposAqui<span class="hl opt">.</span><span class="hl kwd">splice</span><span class="hl opt">(</span>Math<span class="hl opt">.</span><span class="hl kwd">floor</span><span class="hl opt">(</span> equiposAqui<span class="hl opt">.</span>length<span class="hl opt">*</span>Math<span class="hl opt">.</span><span class="hl kwd">random</span><span class="hl opt">()),</span> <span class="hl num">1</span><span class="hl opt">);</span>
	quiniela<span class="hl kwc">[i]</span> <span class="hl opt">=</span> <span class="hl kwa">new</span> <span class="hl kwd">Nuevo_partido</span><span class="hl opt">(</span> equipo1<span class="hl opt">,</span> equipo2 <span class="hl opt">);</span>
	quiniela<span class="hl kwc">[i]</span><span class="hl opt">.</span><span class="hl kwd">setResultado</span><span class="hl opt">(</span> unox2<span class="hl opt">[</span>Math<span class="hl opt">.</span><span class="hl kwd">floor</span><span class="hl opt">(</span> <span class="hl num">3</span><span class="hl opt">*</span>Math<span class="hl opt">.</span><span class="hl kwd">random</span><span class="hl opt">()) ]);</span>
	quiniela<span class="hl kwc">[i]</span><span class="hl opt">.</span><span class="hl kwd">set_to_string</span><span class="hl opt">(</span> imprime <span class="hl opt">);</span>
    <span class="hl opt">}</span>
    <span class="hl kwa">return</span> quiniela<span class="hl opt">;</span>
<span class="hl opt">}</span>

<span class="hl kwa">var</span> quinielas <span class="hl opt">=</span> <span class="hl kwa">new</span> Array<span class="hl opt">;</span>
<span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> <span class="hl num">10</span><span class="hl opt">;</span> i <span class="hl opt">++ ) {</span>
  quinielas<span class="hl kwc">[i]</span> <span class="hl opt">=</span> <span class="hl kwd">jornada</span><span class="hl opt">(</span> equipos <span class="hl opt">);</span> 
<span class="hl opt">}</span>

<span class="hl kwa">var</span> resultados<span class="hl opt">=</span> <span class="hl kwa">new</span> Array<span class="hl opt">;</span>
<span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> i <span class="hl kwa">in</span> equipos <span class="hl opt">) {</span>
  resultados<span class="hl opt">[</span>equipos<span class="hl kwc">[i]</span><span class="hl opt">]=</span><span class="hl num">0</span><span class="hl opt">;</span>
<span class="hl opt">}</span>

<span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> quinielas<span class="hl opt">.</span>length<span class="hl opt">;</span> i <span class="hl opt">++ ) {</span>
    <span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> j <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>j <span class="hl opt">&lt;</span> quinielas<span class="hl kwc">[i]</span><span class="hl opt">.</span>length<span class="hl opt">;</span> j <span class="hl opt">++ ) {</span>
      <span class="hl kwa">var</span> local <span class="hl opt">=</span> quinielas<span class="hl kwc">[i][j]</span><span class="hl opt">.</span>local<span class="hl opt">;</span>
      <span class="hl kwa">var</span> visitante <span class="hl opt">=</span> quinielas<span class="hl kwc">[i][j]</span><span class="hl opt">.</span>visitante<span class="hl opt">;</span>
      <span class="hl kwa">var</span> resultado <span class="hl opt">=</span> quinielas<span class="hl kwc">[i][j]</span><span class="hl opt">.</span>resultado<span class="hl opt">;</span>
      <span class="hl kwa">switch</span> <span class="hl opt">(</span>resultado<span class="hl opt">) {</span>
    <span class="hl kwa">case</span> <span class="hl str">'1'</span><span class="hl opt">:</span>
	resultados<span class="hl kwc">[local]</span><span class="hl opt">+=</span><span class="hl num">3</span><span class="hl opt">;</span>
	<span class="hl kwa">break</span><span class="hl opt">;</span>
    <span class="hl kwa">case</span> <span class="hl str">'x'</span><span class="hl opt">:</span>
	resultados<span class="hl kwc">[local]</span><span class="hl opt">+=</span><span class="hl num">1</span><span class="hl opt">;</span>
	resultados<span class="hl kwc">[visitante]</span><span class="hl opt">+=</span><span class="hl num">1</span><span class="hl opt">;</span>
	<span class="hl kwa">break</span><span class="hl opt">;</span>
    <span class="hl kwa">default</span><span class="hl opt">:</span>
	resultados<span class="hl kwc">[visitante]</span><span class="hl opt">+=</span><span class="hl num">3</span><span class="hl opt">;</span>
    <span class="hl opt">}</span>
  <span class="hl opt">}</span>
<span class="hl opt">}</span>

<span class="hl kwa">for</span> <span class="hl opt">(</span> <span class="hl kwa">var</span> i <span class="hl kwa">in</span> resultados <span class="hl opt">) {</span>
  <span class="hl kwd">print</span><span class="hl opt">(</span> i <span class="hl opt">+</span> <span class="hl str">&quot;: &quot;</span> <span class="hl opt">+</span> resultados<span class="hl kwc">[i]</span><span class="hl opt">)</span>
<span class="hl opt">}</span></code>

<p>La parte nueva de este programa está en en la línea 9, donde se
  define la variable <code>imprime</code>. Se define una función <em>sin
    nombre</em> (lo que se suele denominar un <em>closure</em> o
  función anónima) a la que podemos acceder mediante la variable que
  le hemos asignado. Lo importante de esta sintaxis es que las
  funciones son varibles de pleno derecho, que podemos usar como
  parámetros de otras funciones; esto se usará de forma extensiva
  cuando veamos jQuery y node.js.</p>




<h2><a name='T1:t1:common'> CommonJS, una
    infraestructura común para carga de módulos </a> <a href='#T1:t1:common' style='font-size:small'>#</a></h2>



<p>Uno de los problemas de JS es que, al haber sido desarrollado
  principalmente para trabajar en el navegador, carece de una serie de
  librerías comunes para trabajar en el servidor o en aplicaciones de
  escritorio. <a href='http://www.commonjs.org'>CommonJS</a> es un intento
  de dar tal infraestructura. Principalmente se trata de proveer una
  serie de especificaciones para hacer cosas comunes, desde o más
  simple, que es crear un módulo o librería hasta cosas más complejas:
  interacción con consola o con línea de órdenes. </p>

<p>Por lo pronto la especificación que ha tenido más éxito es la de
  módulos, que <a href='http://dailyjs.com/2010/10/18/modules/'>se
  resume en este artículo</a>; se trata de que un módulo escrito para
  un intérprete (Rhino, por ejemplo) pueda funcionar en otro (tal como
  node.js). Vamos a ver cómo adaptaríamos alguna de las cosas hechas a
  este estándar, por ejemplo, cambiando esto sobre la clase
  Nuevo_partido.js creada anteriormente (la
  llamamos <a href='https://github.com/JJ/curso-js/tree/master/codeUn_Partido.js'>Un_Partido</a>).</p> 
<code class='ejemplo'>exports<span class="hl opt">.</span>Un_Partido <span class="hl opt">=</span> <span class="hl kwa">function</span> <span class="hl opt">(</span>local<span class="hl opt">,</span>visitante<span class="hl opt">,</span>resultado<span class="hl opt">) {</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>local <span class="hl opt">=</span> local<span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>visitante<span class="hl opt">=</span>visitante<span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>resultado<span class="hl opt">=</span>resultado<span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>setResultado <span class="hl opt">=</span> setResultado<span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>toString <span class="hl opt">=</span> toString<span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>set_to_string <span class="hl opt">=</span> set_to_string<span class="hl opt">;</span>
    <span class="hl kwa">this</span><span class="hl opt">.</span>impresor <span class="hl opt">=</span> _toString<span class="hl opt">;</span>
<span class="hl opt">}</span>
</code>

<p>El único cambio ha sido que en vez de definir la función
  directamente, se define como un atributo de <code>exports</code>. El resto, al
  ser atributos de ese objeto, no hace falta que lo definamos de la
  misma forma. Al llamarlo también habrá un pequeño cambio. Mientras
  que antes teníamos que hacer un eval sobre lo cargado, ahora basta
  con (<a href='https://github.com/JJ/curso-js/tree/master/codeusa_partido.js'>programa
  usa_partido.js</a>):</p>
<code class='ejemplo'><span class="hl kwa">var</span> un_partido <span class="hl opt">=</span> <span class="hl kwd">require</span><span class="hl opt">(</span><span class="hl str">'./Un_Partido.js'</span><span class="hl opt">);</span>

<span class="hl kwa">var</span> este_partido <span class="hl opt">=</span> <span class="hl kwa">new</span> un_partido<span class="hl opt">.</span><span class="hl kwd">Un_Partido</span><span class="hl opt">(</span> <span class="hl str">'este'</span><span class="hl opt">,</span><span class="hl str">'otro'</span><span class="hl opt">,</span><span class="hl str">'1'</span><span class="hl opt">);</span>
console<span class="hl opt">.</span><span class="hl kwd">log</span><span class="hl opt">(</span><span class="hl str">'Resultado '</span> <span class="hl opt">+</span> este_partido<span class="hl opt">.</span><span class="hl kwd">toString</span><span class="hl opt">());</span>
</code>
<p>Este módulo ya se comporta como el resto de los módulos de Node,
  haciendo falta usar sólo require (con el camino completo) para
  cargarlo. Ahora, con require lo que definimos es un objeto, y las
  funciones son atributos de ese objeto; por lo que a la hora de
  declarar nuevos objetos de esa clase tendremos que hacerlo
  con <code>new un_partido.Un_Partido</code>. A partir de ahí el
  objeto generado se comporta exactamente igual que cualquier otro
  objeto, como podemos ver usando console. 



<p>A diferencia de casi todos los lenguajes de scripting, no hay un
  modo estándar de instalar módulos Javascript, aunque algunos
  intérpretes (notablemente Node.js, del que hablaremos luego) sí lo
  tienen. De hecho, ni siquiera common.js es universal, existiendo
  otras convenciones que le hacen la competencia tales
  como <a href='http://requirejs.org/'>require.js</a>. La principal
  ventaja de common.js es su aceptación por parte de node.js,
  precisamente y su uso en NPM, por eso cabe suponer que el resto
  empezarán, más o menos, a usarlo. En todo
  caso, <a href='http://requirejs.org/docs/commonjs.html'>son
    enfoques diferentes</a>, uno se concentra en la forma de cargar
  el módulo mientras que otro se concentra en la forma de
  empaquetarlo. </p>

<h2> Para finalizar</h2>



<p>Cualquiera de los recursos que listo ahí abajo pueden resultar
      útiles para ampliar información sobre JavaScript. Quizás también
      pueda ser interesante usar alguna librería que facilite su uso
      como <a href='http://mochi.github.com/mochikit/'>Mochikit</a> o <a
	href='http://www.prototypejs.org/'>Prototype</a>. También el
      <a href='http://code.google.com/webtoolkit/'>Google Web
	Toolkit</a> permite desarrollar en AJAX programando sólo en
      Java, aunque pueda que el JS generado necesite algún retoque
      adicional. </p>

  <p>Puedes continuar viendo <a href='AAP-JavaScript-2.mhtml'>cómo funciona JavaScript en el navegador</a>

<h2><a name='T1:t1:agra'> Agradecimientos </a> <a href='#T1:t1:agra' style='font-size:small'>#</a></h2>



<p>Agradezco a los <a
	href='http://barrapunto.com/comments.pl?sid=69179'>comentaristas</a>
	de <a href='http://barrapunto.com/comments.pl?sid=68032'>los
	diferentes anuncios</a>
	que <a href='http://barrapunto.com/comments.pl?sid=67899'>publiqué
	en Barrapunto</a> sus comentarios y sugerencias. También a
	Javier Espigares por la lectura y comentarios sobre las
	versiones previas de este tema y el anterior.</p>  

<h2><a name='T1:t1:biblio'> Bibliografía </a> <a href='#T1:t1:biblio' style='font-size:small'>#</a></h2>



<p>Hay dos libros fundamentales para aprender JS, aunque están muy
      enfocados a JS en el navegador:<a
	href='http://bencore.ugr.es/iii/encore/record/C|Rb2011082|Sjavascript+definitive+guide|Orightresult|X2?lang=spi&suite=pearl'> <em>Javascript: The Definitive
    Guide</em>, el libro del rinoceronte</a>, editado por O'Reilly, que
      está <a href='http://proquest.safaribooksonline.com/9781449393854?uicode=goliat'>disponible
    como recurso eletrónico en la UGR</a> y <a href='http://bencore.ugr.es/iii/encore/record/C|Rb1987808|Sjavascript+bible|Orightresult|X5?lang=spi&suite=pearl'>	<em>JavaScript Bible, de Danny Goodman</em>, un tocho considerable</a>,
	en el que hay de todo, y que viene con un útil CD con
	ejemplos. También está como  <a
					href='http://proquest.safaribooksonline.com/?uiCode=goliat&xmlId=9780470526910'>recurso
      electrónico</a>. Hay <a href='http://bencore.ugr.es/iii/encore/search/C|Sjavascript|Orightresult|U1?lang=spi&suite=pearl'>muchos
      más recursos, algunos de ellos disponibles de forma electrónica</a>.</p>

<p>Como recursos adicionales, <a
	href=' https://developer.mozilla.org/en-US/docs/JavaScript/About_JavaScript?redirectlocale=en-US&redirectslug=About_JavaScript'>las páginas de Javascript en Mozilla.org</a>, el <a href='http://www.ecma-international.org/publications/standards/Ecma-262.htm'>estándar completo</a>, y el <a href='http://geneura.ugr.es/~victor/cursillos/javascript/js_intro.html'>curso de Javascript de Víctor Rivas Santos</a>. </p> 

<br clear='all'>

<div class='licencia'>Este material
  está <a href='http://curso-sobre.berlios.de/gfdles/'>disponible bajo
    los términos de la licencia GNU FDL</a>. Si observas algún error
  en la página, te agradeceremos que nos hagas llegar un informe de
  error por correo electrónico (dirección abajo) o, si estás dado de
  alta en la asignatura, a través
  del <a href='http://code.google.com/p/aap-etsiit-ugr/issues/entry'>sistema
  de tickets de la misma</a>.  </div>

<div style='float:right'>
  <a href="http://validator.w3.org/check?uri=referer"><img
							 src="http://www.w3.org/Icons/valid-html401"
							 alt="Valid HTML 4.01 Transitional" height="31" width="88"></a>
</div>
    
<p>    <address><a href="mailto:jj (at) merelo.net">Juan
      J. Merelo</a></address> </p>
  </body>
</html>




